{
    "rules": {
        "system": {
            ".read": true,
            ".write": false
        },
        "vouchers": {
            ".read": true,
            "$voucherCode": {
                ".write": false,
                "usedBy": {
                    "$username": {
                        ".write": "!data.exists()",
                        ".validate": "newData.isNumber()"
                    }
                }
            }
        },
        "users": {
            "$username": {
                ".read": true,
                ".write": "!data.exists() || !newData.exists()",
                ".validate": "$username.matches(/^[a-z0-9]+$/) && $username.length >= 3 && $username.length <= 30",
                "saves": {
                    ".write": true,
                    "current": {
                        "xp": {
                            ".validate": "newData.isNumber() && newData.val() >= 0 && (newData.val() <= data.val() + 1000 || !data.exists())"
                        },
                        "level": {
                            ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
                        },
                        "coins": {
                            ".validate": "newData.isNumber() && newData.val() >= 0 && (newData.val() <= data.val() || !data.exists())"
                        },
                        "isPremium": {
                            ".validate": "newData.isBoolean() && (newData.val() == data.val() || !data.exists())"
                        },
                        "name": {
                            ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 60"
                        },
                        "age": {
                            ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 120"
                        },
                        "avatarId": {
                            ".validate": "newData.isNumber() && newData.val() >= 0"
                        }
                    }
                },
                "voucherRewards": {
                    "$rewardId": {
                        ".write": true,
                        ".validate": "newData.hasChildren(['coins', 'timestamp', 'voucherCode'])"
                    }
                }
            }
        }
    }
}