import{G as t}from"./index-8vA0wQKZ.js";const m="https://leximix.de/api",d=2e3,h=()=>{const o=localStorage.getItem("leximix_session_token"),s=localStorage.getItem("leximix_session_expires");if(o&&s){const e=new Date(s);if(new Date<e)return o}return null},u=o=>({[t.SKAT_MAU_MAU]:"maumau",[t.CHESS]:"chess",[t.NINE_MENS_MORRIS]:"morris",[t.CHECKERS]:"checkers",[t.RUMMY]:"rummy",[t.SOLITAIRE]:"solitaire"})[o]||"maumau";async function f(o,s,e,n){try{const r=h();if(!r)throw new Error("Not authenticated");const a=u(o),i=await(await fetch(`${m}/matchmaking/join.php`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-Token":r},body:JSON.stringify({gameType:a,language:n,mmr:1e3})})).json();if(!i.success)throw new Error(i.error||"Failed to join queue")}catch(r){throw console.error("[Matchmaking] Failed to join queue:",r),r}}async function S(o,s){try{const e=h();if(!e)throw new Error("Not authenticated");const n=u(o),a=await(await fetch(`${m}/matchmaking/leave.php`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-Token":e},body:JSON.stringify({gameType:n})})).json();if(!a.success)throw new Error(a.error||"Failed to leave queue")}catch(e){throw console.error("[Matchmaking] Failed to leave queue:",e),e}}async function M(o,s,e){try{const n=h();if(!n)throw new Error("Not authenticated");const r=u(o),c=await(await fetch(`${m}/matchmaking/find.php`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-Token":n},body:JSON.stringify({gameType:r})})).json();if(!c.success)throw new Error(c.error||"Failed to find match");return c.matched?{gameId:c.gameId,opponent:{userId:String(c.opponent.userId),username:c.opponent.username,timestamp:Date.now(),language:"DE"}}:null}catch(n){return console.error("[Matchmaking] Failed to find match:",n),null}}function y(o,s){let e=!0;const n=async()=>{if(e)try{const a=h();if(!a)return;const i=await(await fetch(`${m}/matchmaking/check.php`,{headers:{"X-Session-Token":a}})).json();if(i.success&&i.matched){const p={maumau:t.SKAT_MAU_MAU,chess:t.CHESS,morris:t.NINE_MENS_MORRIS,checkers:t.CHECKERS,rummy:t.RUMMY}[i.gameType]||t.SKAT_MAU_MAU;s({gameId:i.gameId,opponentName:i.opponent.username,mode:p})}}catch(a){console.error("[Matchmaking] Failed to check match:",a)}};n();const r=setInterval(n,d);return()=>{e=!1,clearInterval(r)}}export{M as findMatch,f as joinMatchmakingQueue,S as leaveMatchmakingQueue,y as listenForMatch};
