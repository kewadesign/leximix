import{r as o,d as s,g as h,a as f,s as r,o as l,b as w}from"./index-BVSYnQ3z.js";async function d(t,e,a,u){const i=o(s,`matchmakingQueue/${t}/${e}`),p={userId:e,username:a,timestamp:Date.now(),language:u};await r(i,p)}async function $(t,e){const a=o(s,`matchmakingQueue/${t}/${e}`);await f(a)}async function k(t,e,a){const u=o(s,`matchmakingQueue/${t}`),i=await h(u);if(!i.exists())return null;const p=i.val(),c=Object.values(p).filter(n=>n.userId!==e).sort((n,m)=>n.timestamp-m.timestamp)[0];if(!c)return null;try{const n=o(s,`matchmakingQueue/${t}/${c.userId}`);await f(n);const m=`game_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return await r(o(s,`matches/${c.userId}`),{gameId:m,opponentId:e,opponentName:a,mode:t,timestamp:Date.now()}),await r(o(s,`matches/${e}`),{gameId:m,opponentId:c.userId,opponentName:c.username,mode:t,timestamp:Date.now()}),await $(t,e),{gameId:m,opponent:c}}catch(n){return console.error("Failed to match with opponent",n),null}}function v(t,e){const a=o(s,`matches/${t}`);return l(a,u=>{if(u.exists()){const i=u.val();e(i),f(a)}}),()=>w(a)}export{k as findMatch,d as joinMatchmakingQueue,$ as leaveMatchmakingQueue,v as listenForMatch};
